# 小说分析助手

## 知识库

首先第一步还是搭建知识库。这里涉及到一些配置项：

### 1. 分段设置方法

**1. 分段设置**

1. 分段最大长度：Dify 知识库面向向量模型设计，通常在 200～500 token 范围内效果最佳，因此默认设置为 500 token。
2. 分段重叠长度：为保持上下文连贯，系统会让相邻片段产生约 10% 的重叠，默认重叠 50 token。
3. 文本预处理规则：可选择清理多余空格、换行、制表符，或删除文本中的 URL 与邮箱地址。



**2. 父子分段**

在通用分段外，Dify 还支持父子分段模式：

1. 父块：按标识符划分为较大的文本片段，用作上下文参考。
2. 子块：在父块基础上再细分为更小片段，用于精确检索。命中子块时，系统会同时提供其对应父块内容，帮助模型更好理解上下文，提升知识库回答效果。



### 2. 检索设置方法

**1. 索引方式**

Dify支持两种索引方式：

1. 高质量模式：使用 Embedding 模型对文档向量化，检索更精准，生成答案质量更高（开启后无法切回经济模式）。
2. 经济模式：每个数据块仅用 10 个关键词进行匹配，不消耗 token，但检索精度会有所下降。



**2. Embedding模型**

用于将文本信息转化为向量信息，从而提取语义特征和关联关系。



**3. 检索设置**

最后是设置检索方式。向量检索：通过将用户问题向量化，与知识库中各文本向量进行比对，返回语义最相近的片段。

这里涉及到 3 个配置：

1. Rerank 模型：在初步向量匹配后，对结果进行二次评估，综合语义深度与用户意图，提升相关性排序的准确度。
2. Top K：指定返回的片段数量。
3. Score 阈值：设定相似度下限，如 0.5 以下的结果将被过滤。

此外，系统还支持**全文检索**（基于关键词匹配）与**混合检索**。混合模式可通过设定语义与关键词权重加权排序，或使用 Rerank 模型重新排序候选结果，以提升检索效果。



### 3. 元数据设置方法

元数据指用于描述其他数据的信息，即“关于数据的数据”。它类似书籍的目录或标签，用于说明内容、来源与用途，帮助用户快速理解和管理知识库中的资料。

主要作用包括：

1. 提升检索效率：通过元数据标签可快速筛选相关信息；
2. 保障数据安全：可设置访问权限，限制敏感信息的查看；
3. 优化数据管理：便于分类、存储和维护数据一致性；
4. 支持自动化流程：可在文档管理或分析中触发自动任务，提升效率。

系统默认提供五个参数：

- `document_name`：文件名
- `uploader`：上传者
- `upload_date`：上传时间
- `last_update_date`：最后更新时间
- `source`：文件来源

同时，Dify 也支持用户自定义元数据字段。



## 节点设置

整体工作流图：

<img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2025-10-16-012334.png" alt="image-20251016092334014" style="zoom:50%;" />

1. 开始节点

2. 知识检索节点

3. 意图分类

4. 分类节点（共 6 个）

   1. 人物节点

      System 系统提示词

      ```markdown
      目标：梳理相关剧情线，强调时间/因果。以检索片段为依据。
      输出结构：
      1) 情节概述（≤120字）
      2) 发生顺序与关键节点（时间/场景/冲突/结果，列 3–5 点，标注片段编号）
      3) 对人物弧线的作用（≤80字）
      4) 证据不足时的处理同上
      ```

   2. 情节节点

      System系统提示词

      ```markdown
      目标：梳理相关剧情线，强调时间/因果。以检索片段为依据。
      输出结构：
      1) 情节概述（≤120字）
      2) 发生顺序与关键节点（时间/场景/冲突/结果，列 3–5 点，标注片段编号）
      3) 对人物弧线的作用（≤80字）
      4) 证据不足时的处理同上
      ```

   3. 设定/科学节点

      System系统提示词

      ```markdown
      目标：解释书中科学设定（如量子宏观投影、武器化等），区分“小说设定”与“现实科学”。
      输出结构：
      1) 设定要点（≤120字）
      2) 小说中的使用场景与后果（列 2–4 条，标注片段编号）
      3) 与现实科学的关系：一致/夸张/虚构（≤120字）
      4) 边界与误区提示（≤80字）
      5) 证据不足时的处理同上
      语气：通俗但严谨。
      ```

   4. 主题/哲学节点

      System 系统提示词

      ```markdown
      目标：讨论主题（理性vs伦理、科学是否应设限、存在与毁灭等），以“观点-论据-反思”组织。
      输出结构：
      1) 观点 A（一句话）→ 对应片段编号与简要论据
      2) 观点 B（可选）→ 片段与论据
      3) 反思/反方视角（≤120字）
      4) 与全书叙事/人物的连接（≤80字）
      5) 证据不足时的处理同上
      语气：克制、清晰、少形容词。
      ```

   5. 写作/风格节点

      System 系统提示词

      ```markdown
      目标：分析文本层面的叙事与修辞（节奏、象征、比喻、视角切换等）。
      输出结构：
      1) 风格特征要点（列 2–4 条，标注片段编号）
      2) 典型手法与效果（≤120字）
      3) 与主题/人物的配合（≤80字）
      4) 若需引用，使用“短引+编号”，避免大段原文
      5) 证据不足时的处理同上
      ```

   6. 其它

      System系统词

      ```markdown
      目标：在无法归类或跨类别问题时，给出稳健的综合回答。
      规则：
      - 先判断问题是否与小说内容直接相关；若否，简述边界并礼貌拒答。
      - 若相关：用“摘要→依据→建议延伸阅读”的结构，明确标注片段编号。
      - 若检索为空：明确声明“知识库未命中”，给出可搜索关键词建议（≤50字）。
      ```

5. 结束节点

---

-EOF-

